<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Part 3 Using msm for a basic model | Multi-state modelling with msm: a practical course</title>
  <meta name="description" content="A practical course on multi-state modelling of intermittently-observed data using the msm package for R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Part 3 Using msm for a basic model | Multi-state modelling with msm: a practical course" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A practical course on multi-state modelling of intermittently-observed data using the msm package for R" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Part 3 Using msm for a basic model | Multi-state modelling with msm: a practical course" />
  
  <meta name="twitter:description" content="A practical course on multi-state modelling of intermittently-observed data using the msm package for R" />
  

<meta name="author" content="Christopher Jackson" />


<meta name="date" content="2021-08-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="theory.html"/>
<link rel="next" href="outputs.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Multi-state modelling with msm</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="theory.html"><a href="theory.html"><i class="fa fa-check"></i><b>2</b> Multi-state modelling theory: recap</a>
<ul>
<li class="chapter" data-level="2.1" data-path="theory.html"><a href="theory.html#multi-state-processes"><i class="fa fa-check"></i><b>2.1</b> Multi-state processes</a></li>
<li class="chapter" data-level="2.2" data-path="theory.html"><a href="theory.html#msm-models-work-in-continuous-time"><i class="fa fa-check"></i><b>2.2</b> <code>msm</code> models work in continuous time</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="theory.html"><a href="theory.html#transition-intensities"><i class="fa fa-check"></i><b>2.2.1</b> Transition intensities</a></li>
<li class="chapter" data-level="2.2.2" data-path="theory.html"><a href="theory.html#transition-probabilities"><i class="fa fa-check"></i><b>2.2.2</b> Transition probabilities</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="theory.html"><a href="theory.html#intermittently-observed-data"><i class="fa fa-check"></i><b>2.3</b> Intermittently-observed data</a></li>
<li class="chapter" data-level="2.4" data-path="theory.html"><a href="theory.html#time-to-event-data-not-covered-in-this-course"><i class="fa fa-check"></i><b>2.4</b> Time-to-event data (not covered in this course)</a></li>
<li class="chapter" data-level="2.5" data-path="theory.html"><a href="theory.html#examples-used-for-illustration"><i class="fa fa-check"></i><b>2.5</b> Examples used for illustration</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="theory.html"><a href="theory.html#psoriatic-arthritis"><i class="fa fa-check"></i><b>2.5.1</b> Psoriatic arthritis</a></li>
<li class="chapter" data-level="2.5.2" data-path="theory.html"><a href="theory.html#cardiac-allograft-vasculopathy-after-heart-transplantation"><i class="fa fa-check"></i><b>2.5.2</b> Cardiac allograft vasculopathy after heart transplantation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="msmbasic.html"><a href="msmbasic.html"><i class="fa fa-check"></i><b>3</b> Using msm for a basic model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="msmbasic.html"><a href="msmbasic.html#basic-requirements-for-a-msm-model"><i class="fa fa-check"></i><b>3.1</b> Basic requirements for a msm model</a></li>
<li class="chapter" data-level="3.2" data-path="msmbasic.html"><a href="msmbasic.html#summarising-the-data"><i class="fa fa-check"></i><b>3.2</b> Summarising the data</a></li>
<li class="chapter" data-level="3.3" data-path="msmbasic.html"><a href="msmbasic.html#specifying-the-transition-structure"><i class="fa fa-check"></i><b>3.3</b> Specifying the transition structure</a></li>
<li class="chapter" data-level="3.4" data-path="msmbasic.html"><a href="msmbasic.html#transition-structure-is-for-the-continuous-time-process"><i class="fa fa-check"></i><b>3.4</b> Transition structure is for the continuous time process</a></li>
<li class="chapter" data-level="3.5" data-path="msmbasic.html"><a href="msmbasic.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>3.5</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="3.6" data-path="msmbasic.html"><a href="msmbasic.html#intuition-for-what-transition-intensities-mean"><i class="fa fa-check"></i><b>3.6</b> Intuition for what transition intensities mean</a></li>
<li class="chapter" data-level="3.7" data-path="msmbasic.html"><a href="msmbasic.html#msm-default-output"><i class="fa fa-check"></i><b>3.7</b> <code>msm</code> default output</a></li>
<li class="chapter" data-level="3.8" data-path="msmbasic.html"><a href="msmbasic.html#exact-death-times"><i class="fa fa-check"></i><b>3.8</b> Exact death times</a></li>
<li class="chapter" data-level="3.9" data-path="msmbasic.html"><a href="msmbasic.html#exercises"><i class="fa fa-check"></i><b>3.9</b> Exercises</a></li>
<li class="chapter" data-level="3.10" data-path="msmbasic.html"><a href="msmbasic.html#solutions"><i class="fa fa-check"></i><b>3.10</b> Solutions</a></li>
<li class="chapter" data-level="3.11" data-path="msmbasic.html"><a href="msmbasic.html#postscript-what-if-it-doesnt-converge"><i class="fa fa-check"></i><b>3.11</b> Postscript: What if it doesn’t converge?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>4</b> Prediction from multi-state models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="outputs.html"><a href="outputs.html#mean-sojourn-time-transition-probability-matrix"><i class="fa fa-check"></i><b>4.1</b> Mean sojourn time, transition probability matrix</a></li>
<li class="chapter" data-level="4.2" data-path="outputs.html"><a href="outputs.html#characterising-uncertainty-about-functions-of-intensities"><i class="fa fa-check"></i><b>4.2</b> Characterising uncertainty about functions of intensities</a></li>
<li class="chapter" data-level="4.3" data-path="outputs.html"><a href="outputs.html#total-length-of-stay-in-states"><i class="fa fa-check"></i><b>4.3</b> Total length of stay in states</a></li>
<li class="chapter" data-level="4.4" data-path="outputs.html"><a href="outputs.html#predicting-the-prevalence-of-states-over-time"><i class="fa fa-check"></i><b>4.4</b> Predicting the prevalence of states over time</a></li>
<li class="chapter" data-level="4.5" data-path="outputs.html"><a href="outputs.html#passage-probabilities"><i class="fa fa-check"></i><b>4.5</b> Passage probabilities</a></li>
<li class="chapter" data-level="4.6" data-path="outputs.html"><a href="outputs.html#exercises-1"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
<li class="chapter" data-level="4.7" data-path="outputs.html"><a href="outputs.html#solutions-1"><i class="fa fa-check"></i><b>4.7</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="covariates.html"><a href="covariates.html"><i class="fa fa-check"></i><b>5</b> msm models with covariates</a>
<ul>
<li class="chapter" data-level="5.1" data-path="covariates.html"><a href="covariates.html#reminder-of-covariates-in-multi-state-models"><i class="fa fa-check"></i><b>5.1</b> Reminder of covariates in multi-state models</a></li>
<li class="chapter" data-level="5.2" data-path="covariates.html"><a href="covariates.html#choices-for-modelling-covariates"><i class="fa fa-check"></i><b>5.2</b> Choices for modelling covariates</a></li>
<li class="chapter" data-level="5.3" data-path="covariates.html"><a href="covariates.html#msm-syntax-covariates-on-rates-of-specific-transitions"><i class="fa fa-check"></i><b>5.3</b> msm syntax: covariates on rates of specific transitions</a></li>
<li class="chapter" data-level="5.4" data-path="covariates.html"><a href="covariates.html#covariates-on-all-transition-rates"><i class="fa fa-check"></i><b>5.4</b> Covariates on all transition rates</a></li>
<li class="chapter" data-level="5.5" data-path="covariates.html"><a href="covariates.html#identical-covariate-effects-on-different-transitions"><i class="fa fa-check"></i><b>5.5</b> Identical covariate effects on different transitions</a></li>
<li class="chapter" data-level="5.6" data-path="covariates.html"><a href="covariates.html#covariate-selection"><i class="fa fa-check"></i><b>5.6</b> Covariate selection</a></li>
<li class="chapter" data-level="5.7" data-path="covariates.html"><a href="covariates.html#interpretation-of-the-hazard-ratio"><i class="fa fa-check"></i><b>5.7</b> Interpretation of the hazard ratio</a></li>
<li class="chapter" data-level="5.8" data-path="covariates.html"><a href="covariates.html#outputs-for-different-covariate-values"><i class="fa fa-check"></i><b>5.8</b> Outputs for different covariate values</a></li>
<li class="chapter" data-level="5.9" data-path="covariates.html"><a href="covariates.html#exercises-2"><i class="fa fa-check"></i><b>5.9</b> Exercises</a></li>
<li class="chapter" data-level="5.10" data-path="covariates.html"><a href="covariates.html#solutions-2"><i class="fa fa-check"></i><b>5.10</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="timedep.html"><a href="timedep.html"><i class="fa fa-check"></i><b>6</b> <code>msm</code> models with time-dependent covariates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="timedep.html"><a href="timedep.html#predicting-from-models-with-time-dependent-covariates"><i class="fa fa-check"></i><b>6.1</b> Predicting from models with time dependent covariates</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="timedep.html"><a href="timedep.html#predicting-when-we-know-the-covariate-value-in-advance"><i class="fa fa-check"></i><b>6.1.1</b> Predicting when we know the covariate value in advance</a></li>
<li class="chapter" data-level="6.1.2" data-path="timedep.html"><a href="timedep.html#covariates-may-themselves-change-unpredictably"><i class="fa fa-check"></i><b>6.1.2</b> Covariates may themselves change unpredictably</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="timedep.html"><a href="timedep.html#time-itself-as-a-covariate"><i class="fa fa-check"></i><b>6.2</b> Time itself as a covariate</a></li>
<li class="chapter" data-level="6.3" data-path="timedep.html"><a href="timedep.html#partially-known-states"><i class="fa fa-check"></i><b>6.3</b> Partially-known states</a></li>
<li class="chapter" data-level="6.4" data-path="timedep.html"><a href="timedep.html#shorthand-for-defining-this-model-in-msm"><i class="fa fa-check"></i><b>6.4</b> Shorthand for defining this model in <code>msm</code></a></li>
<li class="chapter" data-level="6.5" data-path="timedep.html"><a href="timedep.html#output-functions-for-models-with-pci"><i class="fa fa-check"></i><b>6.5</b> Output functions for models with <code>pci</code></a></li>
<li class="chapter" data-level="6.6" data-path="timedep.html"><a href="timedep.html#variants-of-pci-models"><i class="fa fa-check"></i><b>6.6</b> Variants of pci models</a></li>
<li class="chapter" data-level="6.7" data-path="timedep.html"><a href="timedep.html#exercises-3"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
<li class="chapter" data-level="6.8" data-path="timedep.html"><a href="timedep.html#solutions-3"><i class="fa fa-check"></i><b>6.8</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>7</b> Advanced topics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="advanced.html"><a href="advanced.html#misclassified-states"><i class="fa fa-check"></i><b>7.1</b> Misclassified states</a></li>
<li class="chapter" data-level="7.2" data-path="advanced.html"><a href="advanced.html#general-hidden-markov-models"><i class="fa fa-check"></i><b>7.2</b> General hidden Markov models</a></li>
<li class="chapter" data-level="7.3" data-path="advanced.html"><a href="advanced.html#semi-markov-models"><i class="fa fa-check"></i><b>7.3</b> Semi-Markov models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="advanced.html"><a href="advanced.html#phase-type-semi-markov-model"><i class="fa fa-check"></i><b>7.3.1</b> “phase-type” semi-Markov model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="advanced.html"><a href="advanced.html#msm-cant-do"><i class="fa fa-check"></i><b>7.4</b> msm can’t do</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Multi-state modelling with msm: a practical course</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="msmbasic" class="section level1" number="3">
<h1><span class="header-section-number">Part 3</span> Using msm for a basic model</h1>
<p>Model the progression through time of joint damage in psoriatic arthritis</p>
<p>Estimate, e.g. </p>
<ul>
<li><p>probability that someone with no damaged joints will have 10 or more damaged joints 5 years from now.</p></li>
<li><p>Total time expected to spend over the next 10 years with 10 or more damaged joints.</p></li>
</ul>
<p>No covariates for the moment.</p>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="msmcourse_files/figure-html/unnamed-chunk-6-1.png" alt="Psoriatic arthritis" width="672" />
<p class="caption">
Figure 3.1: Psoriatic arthritis
</p>
</div>
<div id="basic-requirements-for-a-msm-model" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Basic requirements for a msm model</h2>
<p>At minimum, need to specify</p>
<ul>
<li><p>The dataset, and which columns indicate the state, time (and patient)</p>
<ul>
<li><p>States should be numbers, 1, 2, 3, etc.</p></li>
<li><p>Time should be increasing within each patient</p></li>
<li><p>Patients should be grouped together in the data</p></li>
</ul></li>
<li><p>The <strong>transition structure</strong> of the model</p></li>
</ul>
</div>
<div id="summarising-the-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Summarising the data</h2>
<p>Example <code>psor</code> dataset in the package</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="msmbasic.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(msm)</span>
<span id="cb1-2"><a href="msmbasic.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(psor, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   ptnum  months state hieffusn ollwsdrt
## 1     1  6.4606     1        0        1
## 2     1 17.0780     1        0        1
## 3     2 26.3217     1        0        0
## 4     2 29.4839     3        0        0
## 5     2 30.5763     4        0        0</code></pre>
<ul>
<li><code>ptnum</code>: subject / patient ID</li>
<li><code>months</code>: months of follow up</li>
<li><code>state</code>: state of joint damage</li>
</ul>
<p>A simple summary of the data is a count of the number of <em>transitions over visit intervals</em>, i.e. the number of people observed in one state at one visit, and each other state at the next visit.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="msmbasic.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">statetable.msm</span>(state, ptnum, <span class="at">data=</span>psor)</span></code></pre></div>
<pre><code>##     to
## from   1   2   3   4
##    1 183  56  16   8
##    2   0 100  35  18
##    3   0   0  48  37</code></pre>
<p>For example, 16 people were in state 1 (0-1 damaged joints) at one visit followed by state 3 (5-9 damaged joints) at the next visit.</p>
<p>We also want some idea of the time scale, so we summarise the time variable.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="msmbasic.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(psor<span class="sc">$</span>months)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0712  3.5004  7.3341  9.9557 13.1340 57.0602</code></pre>
<p>The inter-visit times, and number of observations per patient, may also be interesting to summarise.</p>
</div>
<div id="specifying-the-transition-structure" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Specifying the transition structure</h2>
<p>We now define in R which transitions are allowed in <strong>continuous time</strong></p>
<p>Define a matrix with <span class="math inline">\(r\)</span>, <span class="math inline">\(s\)</span> entry</p>
<ul>
<li><p>0 where the <span class="math inline">\(r\)</span>,<span class="math inline">\(s\)</span> transition is disallowed</p></li>
<li><p>1 where the transition is allowed (actually this can be any non-zero positive number)</p></li>
</ul>
<p>In this example we allow transitions from state 1 to state 2, from 2 to 3, and from 3 to 4.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="msmbasic.html#cb7-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb7-2"><a href="msmbasic.html#cb7-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb7-3"><a href="msmbasic.html#cb7-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb7-4"><a href="msmbasic.html#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)) </span></code></pre></div>
<p>The diagonal entries of this matrix do not matter.</p>
</div>
<div id="transition-structure-is-for-the-continuous-time-process" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Transition structure is for the continuous time process</h2>
<p>Note that when we summarised the transitions over visit intervals we counted 16 people in state 3 at the next visit after being observed in state 1.</p>
<p>So why do we not allow a State 1 to State 3 transition?</p>
<p>Because these 1-3 transitions happened <em>over a time interval</em>, not in <em>continuous time</em></p>
<p>These 16 people must have gone through state 2 (unobserved) in between their visits</p>
<p><img src="msmcourse_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Multi-state models are commonly used in situations like this, for <strong>ordered states of disease severity</strong>, e.g. with states derived by discretising a continuous variable. Transitions should then only be allowed between <strong>adjacent states</strong> in continuous time.</p>
</div>
<div id="maximum-likelihood-estimation" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Maximum likelihood estimation</h2>
<p>Now we invoke the <code>msm</code> function to fit the multi-state model to the data: estimating the transition
intensities.</p>
<p>This uses <code>optim</code> to find the minimum of the minus log likelihood. It has to start this search from plausible <em>initial values</em> for the parameters. Two ways to do this:</p>
<ul>
<li><p>Easiest way that usually works: tell <code>msm</code> to auto-generate initial values with the argument <code>gen.inits=TRUE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="msmbasic.html#cb8-1" aria-hidden="true" tabindex="-1"></a>psor.msm <span class="ot">&lt;-</span> <span class="fu">msm</span>(state <span class="sc">~</span> months,</span>
<span id="cb8-2"><a href="msmbasic.html#cb8-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">subject =</span> ptnum,</span>
<span id="cb8-3"><a href="msmbasic.html#cb8-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> psor, </span>
<span id="cb8-4"><a href="msmbasic.html#cb8-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">qmatrix =</span> Q,</span>
<span id="cb8-5"><a href="msmbasic.html#cb8-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">gen.inits=</span><span class="cn">TRUE</span>)</span></code></pre></div></li>
<li><p>Alternatively: supply initial values yourself in the <code>qmatrix</code>, instead of 1s, in the positions corresponding to the transitions.</p>
<p>If you do this for different initial values, and it converges to the same answer, that gives reassurance that the answer is the true maximum likelihood estimate.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="msmbasic.html#cb9-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb9-2"><a href="msmbasic.html#cb9-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>),</span>
<span id="cb9-3"><a href="msmbasic.html#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>),</span>
<span id="cb9-4"><a href="msmbasic.html#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)) </span>
<span id="cb9-5"><a href="msmbasic.html#cb9-5" aria-hidden="true" tabindex="-1"></a>psor.msm <span class="ot">&lt;-</span> <span class="fu">msm</span>(state <span class="sc">~</span> months,</span>
<span id="cb9-6"><a href="msmbasic.html#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">subject =</span> ptnum,</span>
<span id="cb9-7"><a href="msmbasic.html#cb9-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> psor, </span>
<span id="cb9-8"><a href="msmbasic.html#cb9-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">qmatrix =</span> Q,</span>
<span id="cb9-9"><a href="msmbasic.html#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">gen.inits=</span><span class="cn">TRUE</span>)</span></code></pre></div></li>
</ul>
<p>But where do we get the initial values from?</p>
</div>
<div id="intuition-for-what-transition-intensities-mean" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Intuition for what transition intensities mean</h2>
<p>The <em>mean sojourn time</em> <span class="math inline">\(E(T_r)\)</span> is the average time spent in state <span class="math inline">\(r\)</span> before
moving to another state</p>
<p>If the intensities <span class="math inline">\(q_{rs}\)</span> are constant over time, then <span class="math inline">\(E(T_r) = -1/q_{rr}\)</span> where <span class="math inline">\(q_{rr} = -\sum_{s!=r} q_{rs}\)</span></p>
<p>So we might guess that someone spends an average of</p>
<ul>
<li><p>10 months in state 1 before moving to state 2 : <span class="math inline">\(q_{12} = 0.1\)</span></p></li>
<li><p>10 months in state 2 before moving to state 3 : <span class="math inline">\(q_{23} = 0.1\)</span></p></li>
<li><p>10 months in state 3 before moving to state 4 : <span class="math inline">\(q_{23} = 0.1\)</span></p></li>
</ul>
<p>and use these as initial values to start the search for the maximum likelihood estimates. Initial values do not usually need to be close to the true estimates, just within an order of magnitude.</p>
<p>See the exercise for a slightly harder example…</p>
</div>
<div id="msm-default-output" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> <code>msm</code> default output</h2>
<p>When the optimisation has converged, <code>msm</code> returns an object containing list of information about the fitted model (see <code>help(msm.object)</code> for the list structure).</p>
<p>Printing this object gives the estimated transition intensities and their confidence intervals.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="msmbasic.html#cb10-1" aria-hidden="true" tabindex="-1"></a>psor.msm</span></code></pre></div>
<pre><code>## 
## Call:
## msm(formula = state ~ months, subject = ptnum, data = psor, qmatrix = Q,     gen.inits = TRUE)
## 
## Maximum likelihood estimates
## 
## Transition intensities
##                   Baseline                    
## State 1 - State 1 -0.09125 (-0.11366,-0.07325)
## State 1 - State 2  0.09125 ( 0.07325, 0.11366)
## State 2 - State 2 -0.15716 (-0.19699,-0.12538)
## State 2 - State 3  0.15716 ( 0.12538, 0.19699)
## State 3 - State 3 -0.25982 (-0.33538,-0.20129)
## State 3 - State 4  0.25982 ( 0.20129, 0.33538)
## 
## -2 * log-likelihood:  1246.015 
## [Note, to obtain old print format, use &quot;printold.msm&quot;]</code></pre>
<p>How was our initial guess that people spent 10 years in each state?</p>
</div>
<div id="exact-death-times" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Exact death times</h2>
<p>In medical research, we usually know the day when someone dies.</p>
<p>In contrast, the entry time into <em>states of disease</em> is not known in the applications here — we only know the state at intermittent observation times.</p>
<p>Hence, if one of the states is death, then we need to tell <code>msm</code> that the entry time into this state is known exactly, but the state at the previous instant is unknown.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="msmbasic.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">msm</span>(..., <span class="at">deathexact=</span><span class="cn">TRUE</span>, ...)</span></code></pre></div>
<p>More generally, each row of the data could represent a different type of observation, indicated by an extra variable in the dataset, whose name is supplied as the <code>obstype</code> argument to <code>msm</code>. The values of this variable can be 1, 2 or 3, e.g. </p>
<ol style="list-style-type: decimal">
<li><p>an intermittent observation of a state (<code>obstype=1</code>). This is the default.</p></li>
<li><p>known time of transition out of the previously-observed state (<code>obstype=2</code>). Not considered in this course. If all observations are of this type, this is equivalent to time-to-event data where the state is known at all times.</p></li>
<li><p>entry time observed exactly but state at previous instant unknown (<code>obstype=3</code>). If death states always have <code>obtype=3</code>, this is equivalent to <code>deathexact=TRUE</code>.</p></li>
</ol>
<p>Here is an artificial example:</p>
<pre><code>##    PTNUM    years state obstype
## 1 100002 0.000000     1       1
## 2 100002 1.002740     1       1
## 3 100002 2.002740     2       1
## 4 100002 3.093151     2       2
## 5 100002 4.000000     2       1
## 6 100002 4.997260     3       2
## 7 100002 5.854795     4       3</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="msmbasic.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">msm</span>(state <span class="sc">~</span> years, <span class="at">obstype=</span>obstype, ...)</span></code></pre></div>
</div>
<div id="exercises" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Exercises</h2>
<p>From the CAV dataset <code>cav</code> in the package, write R code to:</p>
<ol style="list-style-type: decimal">
<li><p>Summarise the transitions over an interval</p></li>
<li><p>Define a matrix of 1s and 0s indicating the allowed transitions in continuous time. Assume for the moment that people can move to any adjacent disease state, to both more severe or less severe states, and die from any state.</p></li>
<li><p>From the May workshop notes, remind yourself of how the transition intensities are related to the probabilities governing the state that someone will move to on leaving the current state.</p>
<ol style="list-style-type: lower-alpha">
<li><p>From your data summary, make a guess at what these might be.</p></li>
<li><p>Likewise, roughly guess what the mean sojourn times might be.</p></li>
<li><p>Use those guesses to construct a matrix of plausible initial values for the intensities.</p></li>
</ol>
<p>Note that there is no “right answer” for these initial guesses. The learning objective is to be able to convert between transition intensities and more easily-understood quantities.</p></li>
<li><p>Call <code>msm</code> to fit the multi-state model, using</p>
<ol style="list-style-type: lower-alpha">
<li><p>auto-generated initial values from (2) and</p></li>
<li><p>the manually-generated values in (3).</p></li>
</ol>
<p>Death times should be assumed to be known.</p>
<p>Check that the results from different initial values agree with each other, and see how close the true maximum likelihoods are to your initial guess.</p></li>
<li><p>Interpret the maximum likelihood transition intensities in easily-understood terms.</p></li>
</ol>
</div>
<div id="solutions" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Solutions</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="msmbasic.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">statetable.msm</span>(state, PTNUM, <span class="at">data=</span>cav)</span></code></pre></div>
<pre><code>##     to
## from    1    2    3    4
##    1 1367  204   44  148
##    2   46  134   54   48
##    3    4   13  107   55</code></pre>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="msmbasic.html#cb17-1" aria-hidden="true" tabindex="-1"></a>Q_cav <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb17-2"><a href="msmbasic.html#cb17-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb17-3"><a href="msmbasic.html#cb17-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb17-4"><a href="msmbasic.html#cb17-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>For someone in state <span class="math inline">\(r\)</span>, the probability that the next state that they will move to is state <span class="math inline">\(s\)</span> is <span class="math inline">\(-q_{rs} / q_{rr}\)</span>. Row <span class="math inline">\(r\)</span> of the transition intensity matrix corresponds to the transitions out of state <span class="math inline">\(r\)</span>.</li>
</ol>
<p>We can set initial values for this row by first guessing the mean sojourn time <span class="math inline">\(T_r\)</span>, and setting the diagonal entry <span class="math inline">\(q_{rr} = -1/T_{r}\)</span>.</p>
<p>We then set the remaining, off-diagonal values <span class="math inline">\(q_{rs}, s!=r\)</span> according to guesses of the probability <span class="math inline">\(\pi_{rs}\)</span> that the next state will be <span class="math inline">\(s\)</span>, and deducing that since $_{rs} = <span class="math inline">\(-q_{rs} / q_{rr}\)</span>, we can initialise <span class="math inline">\(q_{rs} = \pi_{rs} T_r\)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="msmbasic.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cav<span class="sc">$</span>years)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   1.014   3.893   3.845   5.997  19.460</code></pre>
<p>Looking at the range of observation times in the data, we might guess that the mean sojourn time is 2 years (or within an order of magnitude of this), hence the diagonal entries of the Q matrix are all -0.5.</p>
<p>Then we might guess that there is an equal chance of moving to each of the permitted next states, and set</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="msmbasic.html#cb20-1" aria-hidden="true" tabindex="-1"></a>Q_cav2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,   <span class="fl">0.25</span>,  <span class="dv">0</span>,     <span class="fl">0.25</span>), </span>
<span id="cb20-2"><a href="msmbasic.html#cb20-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>( <span class="fl">0.166</span>, <span class="sc">-</span><span class="fl">0.5</span>,   <span class="fl">0.166</span>, <span class="fl">0.166</span>), </span>
<span id="cb20-3"><a href="msmbasic.html#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>( <span class="dv">0</span>,      <span class="fl">0.25</span>, <span class="sc">-</span><span class="fl">0.5</span>,   <span class="fl">0.25</span>), </span>
<span id="cb20-4"><a href="msmbasic.html#cb20-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>( <span class="dv">0</span>,      <span class="dv">0</span>,     <span class="dv">0</span>,     <span class="dv">0</span>))</span></code></pre></div>
<p>The output of <code>statetable.msm</code> suggests that while this might not be true, it could be within an order of magnitude of the truth, so is likely to be an acceptable as an initial value for optimisation.</p>
<ol start="4" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="msmbasic.html#cb21-1" aria-hidden="true" tabindex="-1"></a>cav.msm <span class="ot">&lt;-</span> <span class="fu">msm</span>(state <span class="sc">~</span> years, <span class="at">subject=</span>PTNUM, <span class="at">data=</span>cav, <span class="at">gen.inits =</span> <span class="cn">TRUE</span>, <span class="at">qmatrix=</span>Q_cav)</span>
<span id="cb21-2"><a href="msmbasic.html#cb21-2" aria-hidden="true" tabindex="-1"></a>cav2.msm <span class="ot">&lt;-</span> <span class="fu">msm</span>(state <span class="sc">~</span> years, <span class="at">subject=</span>PTNUM, <span class="at">data=</span>cav, <span class="at">qmatrix=</span>Q_cav2)</span>
<span id="cb21-3"><a href="msmbasic.html#cb21-3" aria-hidden="true" tabindex="-1"></a>cav.msm</span></code></pre></div>
<pre><code>## 
## Call:
## msm(formula = state ~ years, subject = PTNUM, data = cav, qmatrix = Q_cav,     gen.inits = TRUE)
## 
## Maximum likelihood estimates
## 
## Transition intensities
##                   Baseline                    
## State 1 - State 1 -0.17471 (-0.19506,-0.15649)
## State 1 - State 2  0.12607 ( 0.10968, 0.14491)
## State 1 - State 4  0.04864 ( 0.04008, 0.05903)
## State 2 - State 1  0.23789 ( 0.17790, 0.31810)
## State 2 - State 2 -0.61885 (-0.72334,-0.52945)
## State 2 - State 3  0.30508 ( 0.24457, 0.38056)
## State 2 - State 4  0.07588 ( 0.04289, 0.13427)
## State 3 - State 2  0.15067 ( 0.09222, 0.24616)
## State 3 - State 3 -0.48506 (-0.61548,-0.38227)
## State 3 - State 4  0.33439 ( 0.25533, 0.43794)
## 
## -2 * log-likelihood:  3986.087 
## [Note, to obtain old print format, use &quot;printold.msm&quot;]</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="msmbasic.html#cb23-1" aria-hidden="true" tabindex="-1"></a>cav2.msm</span></code></pre></div>
<pre><code>## 
## Call:
## msm(formula = state ~ years, subject = PTNUM, data = cav, qmatrix = Q_cav2)
## 
## Maximum likelihood estimates
## 
## Transition intensities
##                   Baseline                    
## State 1 - State 1 -0.17472 (-0.19507,-0.15650)
## State 1 - State 2  0.12608 ( 0.10969, 0.14492)
## State 1 - State 4  0.04864 ( 0.04008, 0.05903)
## State 2 - State 1  0.23788 ( 0.17789, 0.31809)
## State 2 - State 2 -0.61881 (-0.72330,-0.52942)
## State 2 - State 3  0.30509 ( 0.24458, 0.38057)
## State 2 - State 4  0.07585 ( 0.04285, 0.13425)
## State 3 - State 2  0.15063 ( 0.09220, 0.24612)
## State 3 - State 3 -0.48505 (-0.61548,-0.38227)
## State 3 - State 4  0.33442 ( 0.25535, 0.43798)
## 
## -2 * log-likelihood:  3986.087 
## [Note, to obtain old print format, use &quot;printold.msm&quot;]</code></pre>
<p>Negligible differences in the estimates and maximised log-likelihood. In practice if the results disagree, the one with the lowest minus 2 x log likelihood is (by definition) closest to the desired maximum likelihood.</p>
<ol start="5" style="list-style-type: decimal">
<li>People in state 1 are around three times as likely to transition next to state 2 (CAV), compared to state 4 (death) (from comparing an intensity of 0.12 with 0.04). The expected time until this transition is -1/0.174 = 6 years.</li>
</ol>
<p>People in state 2 have similar probabilities of transitioning to state 1 and state 3 next, while death is much less likely than a transition to either state 1 or state 3.</p>
<p>People in state 3 are twice as likely to die as regress to state 2.</p>
<p>Periods in state 2 or state 3 last around 2 years on average.</p>
</div>
<div id="postscript-what-if-it-doesnt-converge" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Postscript: What if it doesn’t converge?</h2>
<p>A risk of the kinds of models used here is that they may be weakly identifiable from the data. Often the optimisation will not converge, or converge to an answer that its not sensible.</p>
<p>A common message is</p>
<p><code>Optimisation has probably not converged to the maximum likelihood - Hessian is not positive definite.</code></p>
<p>Another common symptom is very large confidence intervals for certain parameters, e.g. </p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="msmbasic.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Transition intensities</span></span>
<span id="cb25-2"><a href="msmbasic.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                   Baseline                    </span></span>
<span id="cb25-3"><a href="msmbasic.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## State 1 - State 2  0.1 ( 1e-12, 1e+12)</span></span></code></pre></div>
<p>The optimiser claims to have found the maximum likelihood, but the answer is not very useful, because the data contain no information about that parameter, hence the likelihood is flat with respect to that parameters.</p>
<p>In this case the model should be simplified, e.g. by combining states, constraining intensities to be equal to each other, removing covariates or constraining covariate effects (see the next chapter on covariates…)</p>
<p>In some circumstances, numerical overflow/underflow can occur during optimisation, giving messages like</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="msmbasic.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## numerical overflow in calculating likelihood</span></span></code></pre></div>
<p>In these cases we may be able to control the optimisation and help it find the solution.</p>
<ul>
<li><p>Normalising the time variable and covariate values can help (e.g. working with years rather than days, so the time variable takes values around 0-10 rather than 0-4000)</p></li>
<li><p>We can pass arguments to control R’s <code>optim</code> function that <code>msm</code> uses for optimisation, as the <code>control</code> argument to <code>msm</code>. A common trick is to use e.g. <code>msm(..., control=list(fnscale=4000), ...)</code> so that msm will maximise 1/4000 times the log-likelihood, instead of maximising the log-likelihood, if the likelihood takes values of around 4000, say. This ensures that optimisation is done on a normalised scale, helping to avoid numerical computation problems.</p></li>
</ul>
<p>But often the problem is that the model is too complicated for the data!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="theory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="outputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-msm-basic.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["msmcourse.pdf", "msmcourse.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
